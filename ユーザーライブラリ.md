Eclipseユーザーライブラリを使っているマルチモジュールプロジェクトのVS Code移行について、具体的な手順を説明します。

## 1. Eclipseユーザーライブラリの理解

### ユーザーライブラリとは

Eclipseのユーザーライブラリは、複数のJARファイルをグループ化して管理する機能です。

**Eclipseでの.classpath例:**
```xml
<classpath>
    <classpathentry kind="src" path="src"/>
    <classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/Spring5"/>
    <classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/MyBatis"/>
    <classpathentry kind="src" path="/module-a"/>
    <classpathentry kind="output" path="bin"/>
</classpath>
```

`org.eclipse.jdt.USER_LIBRARY/Spring5` = Eclipseワークスペースに登録されたユーザーライブラリ

### ユーザーライブラリの実体

Eclipseワークスペースの設定ファイルに保存されています:

```
~/.eclipse/
└── workspace名/
    └── .metadata/
        └── .plugins/
            └── org.eclipse.core.runtime/
                └── .settings/
                    └── org.eclipse.jdt.core.prefs
```

または

```
workspace/.metadata/.plugins/org.eclipse.jdt.core/UserLibrary.xml
```

## 2. ユーザーライブラリの中身を確認

### 方法A: Eclipseから確認

```
Eclipse > Window > Preferences > Java > Build Path > User Libraries
```

各ユーザーライブラリに含まれるJARファイルの一覧が見られます。

**例:**
```
Spring5 (ユーザーライブラリ名)
  ├── spring-core-5.3.20.jar
  ├── spring-context-5.3.20.jar
  ├── spring-beans-5.3.20.jar
  └── commons-logging-1.2.jar

MyBatis
  ├── mybatis-3.5.10.jar
  └── mybatis-spring-2.0.7.jar
```

### 方法B: UserLibrary.xmlから確認

```bash
# UserLibrary.xmlを探す
find ~/.eclipse -name "*.userlibraries" 2>/dev/null
find ~/workspace/.metadata -name "UserLibrary.xml" 2>/dev/null
```

**UserLibrary.xmlの内容例:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<eclipse-userlibraries>
  <library name="Spring5" systemlibrary="false">
    <archive path="/opt/libraries/spring/spring-core-5.3.20.jar"/>
    <archive path="/opt/libraries/spring/spring-context-5.3.20.jar"/>
  </library>
  <library name="MyBatis" systemlibrary="false">
    <archive path="/opt/libraries/mybatis/mybatis-3.5.10.jar"/>
  </library>
</eclipse-userlibraries>
```

### 方法C: スクリプトで抽出

```bash
#!/bin/bash
# extract_user_libraries.sh

CLASSPATH_FILE=".classpath"

# .classpathからユーザーライブラリ名を抽出
grep "USER_LIBRARY" $CLASSPATH_FILE | \
  sed 's/.*USER_LIBRARY\/\([^"]*\).*/\1/' | \
  sort -u

echo "上記のユーザーライブラリがEclipseに登録されている必要があります"
```

## 3. VS Code移行の戦略

ユーザーライブラリは**Eclipse固有の機能**なので、VS Codeでは直接サポートされません。
以下の4つのアプローチがあります。

### 戦略A: ユーザーライブラリを展開して.classpathに直接記述 (推奨)

**メリット:** VS Codeがそのまま認識できる
**デメリット:** ライブラリ更新時に全モジュールの.classpathを変更する必要がある

**手順:**

1. **ライブラリの配置場所を決める**
```
project-root/
├── lib/
│   ├── spring/
│   │   ├── spring-core-5.3.20.jar
│   │   ├── spring-context-5.3.20.jar
│   │   └── ...
│   └── mybatis/
│       ├── mybatis-3.5.10.jar
│       └── ...
├── module-a/
└── module-b/
```

2. **JARファイルをコピー**
```bash
# Eclipseのユーザーライブラリから実際のJARファイルをコピー
mkdir -p lib/spring
cp /opt/libraries/spring/*.jar lib/spring/

mkdir -p lib/mybatis
cp /opt/libraries/mybatis/*.jar lib/mybatis/
```

3. **.classpathを書き換え**

**変更前:**
```xml
<classpath>
    <classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/Spring5"/>
    <classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/MyBatis"/>
</classpath>
```

**変更後:**
```xml
<classpath>
    <classpathentry kind="lib" path="/lib/spring/spring-core-5.3.20.jar"/>
    <classpathentry kind="lib" path="/lib/spring/spring-context-5.3.20.jar"/>
    <classpathentry kind="lib" path="/lib/spring/spring-beans-5.3.20.jar"/>
    <classpathentry kind="lib" path="/lib/mybatis/mybatis-3.5.10.jar"/>
    <classpathentry kind="lib" path="/lib/mybatis/mybatis-spring-2.0.7.jar"/>
</classpath>
```

または、ワイルドカードで簡略化:
```xml
<classpath>
    <classpathentry kind="lib" path="/lib/spring">
        <attributes>
            <attribute name="module" value="true"/>
        </attributes>
    </classpathentry>
    <classpathentry kind="lib" path="/lib/mybatis">
        <attributes>
            <attribute name="module" value="true"/>
        </attributes>
    </classpathentry>
</classpath>
```

※ただし、VS Codeではディレクトリ指定が認識されない場合があるため、個別に列挙する方が確実です。

4. **自動化スクリプトを作成**

```bash
#!/bin/bash
# convert_user_libraries.sh

# ユーザーライブラリの定義
declare -A SPRING5=(
    [spring-core]="/opt/libraries/spring/spring-core-5.3.20.jar"
    [spring-context]="/opt/libraries/spring/spring-context-5.3.20.jar"
    [spring-beans]="/opt/libraries/spring/spring-beans-5.3.20.jar"
)

declare -A MYBATIS=(
    [mybatis]="/opt/libraries/mybatis/mybatis-3.5.10.jar"
    [mybatis-spring]="/opt/libraries/mybatis/mybatis-spring-2.0.7.jar"
)

# .classpathを書き換える
for MODULE in module-a module-b module-c; do
    CLASSPATH_FILE="$MODULE/.classpath"
    
    # バックアップ
    cp $CLASSPATH_FILE ${CLASSPATH_FILE}.bak
    
    # Spring5を展開
    if grep -q "USER_LIBRARY/Spring5" $CLASSPATH_FILE; then
        for JAR in "${SPRING5[@]}"; do
            # USER_LIBRARYの行を削除して、個別のJARエントリを追加
            # (sed/awk/Pythonなどで実装)
        done
    fi
done
```

### 戦略B: 共通の.classpathファイルを作成

複数モジュールで同じライブラリを使う場合、Eclipse変数を利用:

1. **共通ライブラリの配置**
```
project-root/
└── shared-lib/
    ├── spring/
    └── mybatis/
```

2. **Eclipse変数の定義**
```
Eclipse > Preferences > Java > Build Path > Classpath Variables
```

変数名: `SHARED_LIB`
値: `${workspace_loc}/shared-lib`

3. **.classpathで変数を使用**
```xml
<classpath>
    <classpathentry kind="var" path="SHARED_LIB/spring/spring-core-5.3.20.jar"/>
    <classpathentry kind="var" path="SHARED_LIB/mybatis/mybatis-3.5.10.jar"/>
</classpath>
```

4. **VS Codeでの対応**

VS CodeのJava拡張は、Eclipse変数を部分的にサポートしますが、完全ではありません。

`.vscode/settings.json`で変数を定義:
```json
{
    "java.project.referencedLibraries": [
        "shared-lib/spring/*.jar",
        "shared-lib/mybatis/*.jar"
    ]
}
```

### 戦略C: confディレクトリのプロパティファイルを活用

既にconfディレクトリにライブラリ管理のプロパティファイルがあるなら、それを利用:

**conf/libraries.properties:**
```properties
spring.core=/opt/libraries/spring/spring-core-5.3.20.jar
spring.context=/opt/libraries/spring/spring-context-5.3.20.jar
mybatis.core=/opt/libraries/mybatis/mybatis-3.5.10.jar
```

**スクリプトで.classpathを生成:**
```bash
#!/bin/bash
# generate_classpath.sh

PROPS_FILE="conf/libraries.properties"
MODULE_DIR=$1
CLASSPATH_FILE="$MODULE_DIR/.classpath"

# .classpathのヘッダー
cat > $CLASSPATH_FILE <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<classpath>
    <classpathentry kind="src" path="src"/>
    <classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
EOF

# プロパティファイルから読み込んでエントリを追加
while IFS='=' read -r key value; do
    if [[ ! -z "$value" ]]; then
        echo "    <classpathentry kind=\"lib\" path=\"$value\"/>" >> $CLASSPATH_FILE
    fi
done < $PROPS_FILE

# .classpathのフッター
cat >> $CLASSPATH_FILE <<EOF
    <classpathentry kind="output" path="bin"/>
</classpath>
EOF

echo "Generated $CLASSPATH_FILE"
```

使い方:
```bash
./generate_classpath.sh module-a
./generate_classpath.sh module-b
./generate_classpath.sh module-c
```

### 戦略D: 段階的移行 - ハイブリッドアプローチ (現実的)

**フェーズ1: Eclipse環境を維持しながら準備**
```
1. ユーザーライブラリの棚卸し
2. libディレクトリにJARファイルを集約
3. ドキュメント化 (どのライブラリがどのモジュールで使われているか)
```

**フェーズ2: 一部モジュールで試験的に移行**
```
1. 単純なモジュール(依存が少ない)から開始
2. .classpathを直接記述方式に変更
3. VS Codeでビルド・デバッグを確認
```

**フェーズ3: 全モジュール移行**
```
1. 自動化スクリプトで一括変換
2. 各モジュールで動作確認
3. Eclipseユーザーライブラリを削除
```

## 4. 具体的な移行手順

### ステップ1: ユーザーライブラリの棚卸し

```bash
#!/bin/bash
# inventory_user_libraries.sh

echo "=== ユーザーライブラリ使用状況 ==="

for MODULE in module-*; do
    echo ""
    echo "[$MODULE]"
    grep "USER_LIBRARY" $MODULE/.classpath | \
      sed 's/.*USER_LIBRARY\/\([^"]*\).*/  - \1/'
done
```

実行結果例:
```
[module-a]
  - Spring5
  - MyBatis

[module-b]
  - Spring5
  - Jackson

[module-c]
  - MyBatis
```

### ステップ2: JARファイルの集約

```bash
#!/bin/bash
# collect_jars.sh

# libディレクトリを作成
mkdir -p lib/{spring,mybatis,jackson}

# Eclipseのユーザーライブラリから実際のパスを取得
# (UserLibrary.xmlを解析、または手動で確認)

# 例: Spring5のJARをコピー
cp /opt/libraries/spring/*.jar lib/spring/

# 例: MyBatisのJARをコピー
cp /opt/libraries/mybatis/*.jar lib/mybatis/

# 例: JacksonのJARをコピー
cp /opt/libraries/jackson/*.jar lib/jackson/
```

### ステップ3: .classpathの変換

```python
#!/usr/bin/env python3
# convert_classpath.py

import xml.etree.ElementTree as ET
import sys
import os

# ユーザーライブラリの定義
USER_LIBRARIES = {
    "Spring5": [
        "/lib/spring/spring-core-5.3.20.jar",
        "/lib/spring/spring-context-5.3.20.jar",
        "/lib/spring/spring-beans-5.3.20.jar",
    ],
    "MyBatis": [
        "/lib/mybatis/mybatis-3.5.10.jar",
        "/lib/mybatis/mybatis-spring-2.0.7.jar",
    ],
    "Jackson": [
        "/lib/jackson/jackson-core-2.15.0.jar",
        "/lib/jackson/jackson-databind-2.15.0.jar",
    ]
}

def convert_classpath(module_path):
    classpath_file = os.path.join(module_path, ".classpath")
    
    if not os.path.exists(classpath_file):
        print(f"Warning: {classpath_file} not found")
        return
    
    # バックアップ
    backup_file = classpath_file + ".bak"
    os.rename(classpath_file, backup_file)
    
    # XMLを解析
    tree = ET.parse(backup_file)
    root = tree.getroot()
    
    # USER_LIBRARYエントリを探して置き換え
    entries_to_remove = []
    entries_to_add = []
    
    for entry in root.findall("classpathentry"):
        if entry.get("kind") == "con":
            path = entry.get("path", "")
            if "USER_LIBRARY" in path:
                lib_name = path.split("/")[-1]
                entries_to_remove.append(entry)
                
                if lib_name in USER_LIBRARIES:
                    for jar_path in USER_LIBRARIES[lib_name]:
                        new_entry = ET.Element("classpathentry")
                        new_entry.set("kind", "lib")
                        new_entry.set("path", jar_path)
                        entries_to_add.append(new_entry)
                else:
                    print(f"Warning: Unknown user library '{lib_name}' in {module_path}")
    
    # 古いエントリを削除
    for entry in entries_to_remove:
        root.remove(entry)
    
    # 新しいエントリを追加
    for entry in entries_to_add:
        root.append(entry)
    
    # 保存
    tree.write(classpath_file, encoding="UTF-8", xml_declaration=True)
    print(f"Converted: {classpath_file}")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python convert_classpath.py <module_path>")
        sys.exit(1)
    
    convert_classpath(sys.argv[1])
```

使い方:
```bash
python convert_classpath.py module-a
python convert_classpath.py module-b
python convert_classpath.py module-c
```

### ステップ4: VS Codeでの確認

```bash
# VS Codeで開く
code .

# Java Language Serverを再起動
# Ctrl+Shift+P > "Java: Clean Java Language Server Workspace"
```

確認項目:
- [ ] 各モジュールのソースコードにエラーがないか
- [ ] モジュール間の参照が正常か
- [ ] 外部ライブラリのクラスが認識されているか
- [ ] コード補完が動作するか

### ステップ5: ビルドの確認

```bash
# VS Codeの自動ビルドを確認
# または手動でコンパイル

# Javaファイルを編集して保存 → bin/にクラスファイルが生成されるか確認
```

## 5. トラブルシューティング

### 問題1: VS Codeがライブラリを認識しない

**原因:** .classpathのパスが相対パスではない、またはVS Codeが再読み込みしていない

**対処:**
```json
// .vscode/settings.json
{
    "java.project.referencedLibraries": [
        "lib/**/*.jar"
    ]
}
```

または
```bash
# Java Language Serverを再起動
Ctrl+Shift+P > "Java: Clean Java Language Server Workspace"
```

### 問題2: 相対パスと絶対パス

**.classpathでの記述:**
```xml
<!-- 相対パス (推奨) -->
<classpathentry kind="lib" path="lib/spring/spring-core-5.3.20.jar"/>

<!-- プロジェクトルートからの絶対パス -->
<classpathentry kind="lib" path="/lib/spring/spring-core-5.3.20.jar"/>

<!-- システムの絶対パス (非推奨) -->
<classpathentry kind="lib" path="/opt/libraries/spring/spring-core-5.3.20.jar"/>
```

相対パスを使うことで、プロジェクトをどこに配置しても動作します。

### 問題3: ライブラリの重複

複数モジュールで同じJARファイルを参照している場合、libディレクトリを共有:

```
project-root/
├── lib/          # 全モジュール共通
│   ├── spring/
│   └── mybatis/
├── module-a/
│   └── .classpath  → ../lib/を参照
└── module-b/
    └── .classpath  → ../lib/を参照
```

## 6. まとめ: 推奨アプローチ

あなたの状況(Gradleは本番ビルドのみ、confにプロパティファイルあり)では:

**最も現実的な方法:**

1. **libディレクトリにJARを集約**
   - confのプロパティファイルと連携
   - バージョン管理を一元化

2. **スクリプトで.classpathを自動生成**
   - プロパティファイルから読み込む
   - 全モジュールに適用

3. **Eclipse/VS Code両対応**
   - .classpathはそのまま維持
   - 両方の環境で開発可能

4. **本番ビルドは変更なし**
   - Gradleはそのまま
   - CI/CDパイプラインも変更不要

この方法なら、開発環境の移行と本番ビルドを分離でき、段階的に進められます。

ユーザーライブラリは**廃止して、libディレクトリに実体のJARファイルを配置する方式に変更すべき**です。

## 結論: ユーザーライブラリの取り扱い

### やるべきこと

```
【Before】Eclipse依存の構成
project-root/
├── module-a/.classpath
│   └── <classpathentry kind="con" path="...USER_LIBRARY/Spring5"/>
├── module-b/.classpath
│   └── <classpathentry kind="con" path="...USER_LIBRARY/Spring5"/>
└── (JARファイルの実体はEclipseワークスペース外)

【After】VS Code対応の構成
project-root/
├── lib/                    # ←新規作成
│   ├── spring/
│   │   ├── spring-core-5.3.20.jar
│   │   ├── spring-context-5.3.20.jar
│   │   └── ...
│   └── mybatis/
│       ├── mybatis-3.5.10.jar
│       └── ...
├── module-a/.classpath
│   └── <classpathentry kind="lib" path="../lib/spring/spring-core-5.3.20.jar"/>
└── module-b/.classpath
    └── <classpathentry kind="lib" path="../lib/spring/spring-core-5.3.20.jar"/>
```

## 具体的な手順

### ステップ1: JARファイルの実体を探す

Eclipseで各ユーザーライブラリがどこにあるか確認:

```
Eclipse > Window > Preferences > Java > Build Path > User Libraries
> Spring5を選択 > 各JARのパスをメモ
```

または、コマンドで:
```bash
find ~/.eclipse -name "*.userlibraries" -exec cat {} \;
# または
cat ~/workspace/.metadata/.plugins/org.eclipse.jdt.core/UserLibrary.xml
```

### ステップ2: libディレクトリにコピー

```bash
# プロジェクトルートで実行
mkdir -p lib/spring
mkdir -p lib/mybatis

# ユーザーライブラリのJARをコピー
cp /path/to/spring/*.jar lib/spring/
cp /path/to/mybatis/*.jar lib/mybatis/

# 確認
ls -la lib/spring/
ls -la lib/mybatis/
```

### ステップ3: 全モジュールの.classpathを書き換え

```bash
# 例: module-aの.classpath
```

**変更前:**
```xml
<classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/Spring5"/>
```

**変更後:**
```xml
<classpathentry kind="lib" path="../lib/spring/spring-core-5.3.20.jar"/>
<classpathentry kind="lib" path="../lib/spring/spring-context-5.3.20.jar"/>
<classpathentry kind="lib" path="../lib/spring/spring-beans-5.3.20.jar"/>
```

### ステップ4: スクリプトで自動化

全モジュールを一括変換するスクリプト:

```bash
#!/bin/bash
# replace_user_libraries.sh

# ユーザーライブラリ名とJARファイルのマッピング
declare -a SPRING5_JARS=(
    "../lib/spring/spring-core-5.3.20.jar"
    "../lib/spring/spring-context-5.3.20.jar"
    "../lib/spring/spring-beans-5.3.20.jar"
)

declare -a MYBATIS_JARS=(
    "../lib/mybatis/mybatis-3.5.10.jar"
    "../lib/mybatis/mybatis-spring-2.0.7.jar"
)

# 各モジュールを処理
for MODULE_DIR in module-*; do
    CLASSPATH_FILE="$MODULE_DIR/.classpath"
    
    if [ ! -f "$CLASSPATH_FILE" ]; then
        continue
    fi
    
    echo "Processing $MODULE_DIR..."
    
    # バックアップ
    cp "$CLASSPATH_FILE" "$CLASSPATH_FILE.bak"
    
    # USER_LIBRARY/Spring5を置き換え
    if grep -q "USER_LIBRARY/Spring5" "$CLASSPATH_FILE"; then
        # USER_LIBRARY行を削除
        sed -i '/USER_LIBRARY\/Spring5/d' "$CLASSPATH_FILE"
        
        # </classpath>の前に新しいエントリを挿入
        for JAR in "${SPRING5_JARS[@]}"; do
            sed -i "s|</classpath>|    <classpathentry kind=\"lib\" path=\"$JAR\"/>\n</classpath>|" "$CLASSPATH_FILE"
        done
    fi
    
    # USER_LIBRARY/MyBatisを置き換え
    if grep -q "USER_LIBRARY/MyBatis" "$CLASSPATH_FILE"; then
        sed -i '/USER_LIBRARY\/MyBatis/d' "$CLASSPATH_FILE"
        
        for JAR in "${MYBATIS_JARS[@]}"; do
            sed -i "s|</classpath>|    <classpathentry kind=\"lib\" path=\"$JAR\"/>\n</classpath>|" "$CLASSPATH_FILE"
        done
    fi
    
    echo "  → Converted"
done

echo "Done. Backup files: *.classpath.bak"
```

実行:
```bash
chmod +x replace_user_libraries.sh
./replace_user_libraries.sh
```

## なぜユーザーライブラリを廃止すべきか

### 理由1: Eclipse専用機能で移植性がない
- VS Codeでは認識されない
- IntelliJ IDEAでも認識されない
- チーム開発で各自がEclipseワークスペースを設定する必要がある

### 理由2: 実体が不明確
- JARファイルがどこにあるか分からない
- バージョン管理(Git)に含められない
- 新メンバーが環境構築で困る

### 理由3: 本番ビルドと乖離
- Gradleは実体のJARファイルを見る
- 開発環境と本番環境で依存関係が異なる可能性

### 理由4: 保守性が低い
- ライブラリ更新時に各開発者がEclipseで再設定
- 誰がどのバージョンを使っているか把握困難

## libディレクトリ方式のメリット

### ✅ 移植性が高い
- Eclipse、VS Code、IntelliJ、どれでも動く
- `.classpath`さえあれば環境構築完了

### ✅ バージョン管理が明確
```bash
git add lib/
git commit -m "Add dependencies"
```
実体をリポジトリに含めるか、`.gitignore`して別管理するか選択可能

### ✅ ドキュメント不要
```bash
ls lib/spring/
# → spring-core-5.3.20.jar などが見える
# バージョンが一目瞭然
```

### ✅ confのプロパティファイルと整合性が取れる
```properties
# conf/libraries.properties
spring.version=5.3.20
mybatis.version=3.5.10
```

## 移行後の管理方法

### パターンA: libディレクトリをGitで管理

```bash
# .gitignoreに含めない
git add lib/
git commit -m "Add library JARs"
```

**メリット:** クローンするだけで開発開始可能
**デメリット:** リポジトリサイズが大きくなる

### パターンB: libディレクトリを外部管理

```bash
# .gitignoreに追加
echo "lib/" >> .gitignore

# READMEに記載
echo "lib/ディレクトリは社内共有サーバーからコピーしてください" >> README.md
```

または、ダウンロードスクリプトを用意:
```bash
#!/bin/bash
# setup_libraries.sh

mkdir -p lib/spring lib/mybatis

# 社内リポジトリからダウンロード
curl -o lib/spring/spring-core-5.3.20.jar http://internal-repo/spring-core-5.3.20.jar
curl -o lib/mybatis/mybatis-3.5.10.jar http://internal-repo/mybatis-3.5.10.jar
```

### パターンC: confのプロパティファイルと連動

```properties
# conf/libraries.properties
spring.core.path=lib/spring/spring-core-5.3.20.jar
spring.context.path=lib/spring/spring-context-5.3.20.jar
mybatis.core.path=lib/mybatis/mybatis-3.5.10.jar
```

スクリプトで`.classpath`を自動生成:
```bash
./generate_classpath_from_conf.sh
```

## まとめ: ユーザーライブラリの扱い

**結論:**
1. **ユーザーライブラリは廃止する**
2. **libディレクトリにJARファイルの実体を配置**
3. **全モジュールの.classpathを書き換え**
4. **スクリプトで自動化して一括変換**

これにより:
- Eclipse/VS Code両対応
- チーム開発しやすい
- 本番ビルド(Gradle)と整合性が取れる
- 新メンバーの環境構築が簡単

ユーザーライブラリは便利ですが、**Eclipse専用の機能**なので、移行を機に実体ベースの管理に切り替えるべきです。

はい、可能です。プロジェクト構造を変えずに、**VS Codeの設定だけで対応**できます。

## VS Code側の設定のみで対応する方法

### 前提条件の確認

まず、Eclipseユーザーライブラリの実体(JARファイル)がどこにあるか確認します:

```
Eclipse > Window > Preferences > Java > Build Path > User Libraries
> Spring5を選択 > 各JARのLocationをメモ
```

例:
```
Spring5:
  /opt/libraries/spring/spring-core-5.3.20.jar
  /opt/libraries/spring/spring-context-5.3.20.jar

MyBatis:
  /opt/libraries/mybatis/mybatis-3.5.10.jar
```

## 解決策: VS Codeのsettings.jsonで対応

### 方法1: java.project.referencedLibraries を使う (推奨)

`.vscode/settings.json` を作成:

```json
{
    "java.project.referencedLibraries": [
        "/opt/libraries/spring/*.jar",
        "/opt/libraries/mybatis/*.jar",
        "/opt/libraries/jackson/*.jar"
    ]
}
```

これにより:
- `.classpath`は変更不要
- Eclipse上では従来通りユーザーライブラリを使用
- VS Code上では`referencedLibraries`で指定したJARを認識

### 方法2: 環境変数を使って柔軟に対応

開発者ごとにライブラリの場所が異なる場合:

**環境変数を設定:**
```bash
# ~/.bashrc または ~/.zshrc
export JAVA_LIB_HOME=/opt/libraries
```

**.vscode/settings.json:**
```json
{
    "java.project.referencedLibraries": [
        "${env:JAVA_LIB_HOME}/spring/*.jar",
        "${env:JAVA_LIB_HOME}/mybatis/*.jar"
    ]
}
```

### 方法3: 相対パスで共有ライブラリを参照

チーム開発で共有サーバーにライブラリがある場合:

```json
{
    "java.project.referencedLibraries": [
        "//shared-server/libraries/spring/*.jar",
        "//shared-server/libraries/mybatis/*.jar"
    ]
}
```

または、シンボリックリンクを使う:
```bash
# プロジェクトルートで実行
ln -s /opt/libraries ./external-libs

# .vscode/settings.json
{
    "java.project.referencedLibraries": [
        "external-libs/spring/*.jar",
        "external-libs/mybatis/*.jar"
    ]
}
```

```bash
# .gitignoreに追加
echo "external-libs" >> .gitignore
```

## 完全な設定例

### .vscode/settings.json (完全版)

```json
{
    // Javaのバージョン設定
    "java.configuration.runtimes": [
        {
            "name": "JavaSE-11",
            "path": "/usr/lib/jvm/java-11-openjdk",
            "default": true
        }
    ],
    
    // ビルド設定の自動更新
    "java.configuration.updateBuildConfiguration": "automatic",
    
    // Eclipseユーザーライブラリの代替
    "java.project.referencedLibraries": [
        // Spring5ユーザーライブラリの代替
        "/opt/libraries/spring/spring-core-*.jar",
        "/opt/libraries/spring/spring-context-*.jar",
        "/opt/libraries/spring/spring-beans-*.jar",
        "/opt/libraries/spring/spring-web-*.jar",
        
        // MyBatisユーザーライブラリの代替
        "/opt/libraries/mybatis/mybatis-*.jar",
        "/opt/libraries/mybatis/mybatis-spring-*.jar",
        
        // Jacksonユーザーライブラリの代替
        "/opt/libraries/jackson/jackson-core-*.jar",
        "/opt/libraries/jackson/jackson-databind-*.jar",
        "/opt/libraries/jackson/jackson-annotations-*.jar",
        
        // その他の共通ライブラリ
        "/opt/libraries/commons/*.jar"
    ],
    
    // Gradle/Mavenインポートを無効化 (Eclipseプロジェクトのみ使用)
    "java.import.gradle.enabled": false,
    "java.import.maven.enabled": false,
    
    // 出力先
    "java.project.outputPath": "bin",
    
    // ソースエンコーディング
    "files.encoding": "utf8",
    
    // 自動保存でビルド
    "java.autobuild.enabled": true
}
```

## マルチモジュールプロジェクトの場合

各モジュールで異なるライブラリを使う場合は、ルートの`.vscode/settings.json`に全て列挙:

```json
{
    "java.project.referencedLibraries": [
        // module-a用
        "/opt/libraries/spring/*.jar",
        
        // module-b用  
        "/opt/libraries/spring/*.jar",
        "/opt/libraries/mybatis/*.jar",
        
        // module-c用
        "/opt/libraries/mybatis/*.jar",
        "/opt/libraries/jackson/*.jar"
    ]
}
```

重複していても問題ありません。VS Codeが自動的に整理します。

## confのプロパティファイルを活用する方法

既に`conf/libraries.properties`がある場合、スクリプトで`.vscode/settings.json`を自動生成:

**conf/libraries.properties:**
```properties
spring.lib.path=/opt/libraries/spring
mybatis.lib.path=/opt/libraries/mybatis
jackson.lib.path=/opt/libraries/jackson
```

**generate_vscode_settings.sh:**
```bash
#!/bin/bash

PROPS_FILE="conf/libraries.properties"
OUTPUT_FILE=".vscode/settings.json"

# .vscodeディレクトリ作成
mkdir -p .vscode

# settings.jsonの生成開始
cat > $OUTPUT_FILE <<'EOF'
{
    "java.configuration.updateBuildConfiguration": "automatic",
    "java.import.gradle.enabled": false,
    "java.import.maven.enabled": false,
    "java.project.referencedLibraries": [
EOF

# プロパティファイルから読み込んでパスを追加
while IFS='=' read -r key value; do
    if [[ $key == *.lib.path ]]; then
        echo "        \"$value/*.jar\"," >> $OUTPUT_FILE
    fi
done < $PROPS_FILE

# 最後のカンマを削除してJSONを閉じる
sed -i '$ s/,$//' $OUTPUT_FILE
cat >> $OUTPUT_FILE <<'EOF'
    ]
}
EOF

echo "Generated $OUTPUT_FILE"
```

使い方:
```bash
chmod +x generate_vscode_settings.sh
./generate_vscode_settings.sh
```

生成される`.vscode/settings.json`:
```json
{
    "java.configuration.updateBuildConfiguration": "automatic",
    "java.import.gradle.enabled": false,
    "java.import.maven.enabled": false,
    "java.project.referencedLibraries": [
        "/opt/libraries/spring/*.jar",
        "/opt/libraries/mybatis/*.jar",
        "/opt/libraries/jackson/*.jar"
    ]
}
```

## .gitignoreの設定

`.vscode/settings.json`をGitで管理するかどうか:

### パターンA: チーム全体で同じパスを使う場合
```bash
# .vscode/settings.jsonをコミット
git add .vscode/settings.json
git commit -m "Add VS Code settings"
```

### パターンB: 開発者ごとにパスが異なる場合
```bash
# .gitignoreに追加
echo ".vscode/settings.json" >> .gitignore

# テンプレートを提供
cp .vscode/settings.json .vscode/settings.json.template
git add .vscode/settings.json.template
```

各開発者が:
```bash
cp .vscode/settings.json.template .vscode/settings.json
# 自分の環境に合わせてパスを修正
```

## 動作確認

### ステップ1: VS Codeを再起動
```bash
# VS Codeを閉じて再度開く
code .
```

### ステップ2: Java Language Serverを再起動
```
Ctrl+Shift+P > "Java: Clean Java Language Server Workspace"
```

### ステップ3: 確認項目
- [ ] Javaファイルを開いてエラーが出ないか
- [ ] 外部ライブラリのクラスにカーソルを合わせて定義にジャンプできるか (F12)
- [ ] コード補完が効くか (Ctrl+Space)
- [ ] モジュール間の参照が正常か

### ステップ4: ビルド確認
```bash
# ファイルを編集して保存
# → bin/にクラスファイルが自動生成されることを確認
```

## トラブルシューティング

### 問題1: ライブラリが認識されない

**確認1: パスが正しいか**
```bash
ls /opt/libraries/spring/*.jar
# JARファイルが表示されるか確認
```

**確認2: settings.jsonの構文エラー**
```
Ctrl+Shift+P > "Preferences: Open Settings (JSON)"
# JSONが正しいか確認
```

**確認3: Java Language Serverのログ確認**
```
Ctrl+Shift+P > "Java: Open Java Language Server Log File"
# エラーメッセージを確認
```

### 問題2: .classpathのUSER_LIBRARYが邪魔をする

VS Codeが`.classpath`のUSER_LIBRARYエントリを認識してエラーを出す場合:

**.vscode/settings.json に追加:**
```json
{
    "java.import.exclusions": [
        "**/org.eclipse.jdt.USER_LIBRARY/**"
    ]
}
```

### 問題3: ワイルドカード(*)が効かない

特定のJARファイルのみを個別に指定:
```json
{
    "java.project.referencedLibraries": [
        "/opt/libraries/spring/spring-core-5.3.20.jar",
        "/opt/libraries/spring/spring-context-5.3.20.jar",
        "/opt/libraries/mybatis/mybatis-3.5.10.jar"
    ]
}
```

## まとめ: プロジェクト構造を変えない対応

**結論:**
- ✅ `.classpath`は変更不要
- ✅ Eclipseユーザーライブラリも残したまま
- ✅ `.vscode/settings.json`だけで対応可能
- ✅ Eclipse/VS Code両環境で開発可能

**必要な作業:**
1. Eclipseでユーザーライブラリの実体のパスを確認
2. `.vscode/settings.json`を作成
3. `java.project.referencedLibraries`に実体のパスを記述
4. VS Codeを再起動して確認

これで、プロジェクト構造を一切変更せず、VS Code側の設定だけで対応できます。